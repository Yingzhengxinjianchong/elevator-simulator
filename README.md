# 电梯调度系统（多线程仿真）

## 项目名称

电梯调度系统仿真平台（多线程操作系统模拟）

---

## 项目简介

本项目通过模拟一个 20 层大楼中 5 部电梯的调度运行过程，实现一个具备图形界面的电梯系统仿真平台。通过内部与外部请求的统一调度与处理，真实模拟现实电梯响应过程、状态切换和资源竞争场景。

---

## 使用技术

* **语言**：Python 3.11+
* **图形界面**：Gradio（v5.29.1）
* **并发机制**：`threading.Thread`, `Lock`, `Semaphore`
* **向量逻辑通信**：状态管理模块 `elevator_state.py` + GUI 主动推送
* **项目结构**：前后端逻辑解耦，支持扩展

---

## 如何运行

1. 安装依赖环境：

   ```bash
   pip install gradio
   ```

2. 启动程序主入口：

   ```bash
   python main.py
   ```

3. 使用浏览器访问自动打开的 Gradio 页面，开始电梯调度测试。

---

## 文件说明

| 文件 / 目录             | 说明                            |
| ------------------- | ----------------------------- |
| `elevator.py`       | 每一部电梯对应一个线程，负责移动、请求处理、门开关等行为  |
| `dispatcher.py`     | 统一调度器，管理外部请求池和多线程间的同步互斥（写者优先） |
| `request.py`        | 枚举类和请求结构体定义（请求类型、方向、楼层等）      |
| `main.py`           | 项目主入口，初始化线程与 UI               |
| `elevator_ui.py`    | 基于 Gradio 的前端界面构建             |
| `elevator_state.py` | 电梯状态集中管理，提供状态广播函数供前端同步        |
| `gui/`              | 前端展示组件和图标资源文件夹                |
| `elevator_log.txt`  | 电梯运行日志输出（移动、开关门等）             |

---

## 调度算法设计：历史方向优先 + 时间戳兜底策略

### 核心思想：

1. 内部请求优先级高于外部请求，避免无关电梯浪费调度资源；
2. 电梯运行方向保持原向尽可能多处理请求，避免频繁换向；
3. 方向无请求时，回溯历史方向寻找最近的请求；
4. 仍无请求时，采用最早发出的请求（基于时间戳）作为目标。

### 简化流程：


1. 获取所有请求（internal + external）
2. 若当前层有请求，立即处理
3. 若电梯上行：优先处理楼上的请求，否则改向下行
4. 若电梯下行：优先处理楼下的请求，否则改向上行
5. 若空闲：回忆历史方向尝试继续；仍无则取最早请求作为目标

---

## 多线程同步互斥设计：写者优先读写锁策略

### 外部请求池：临界资源

* 所有电梯共享一组外部请求（上/下行请求按钮）
* 任一电梯可读取，任何新请求按钮点击为写操作

### 采用写者优先读写锁控制机制：

**读者入口：read_try + r_mutex**
- 若已有写者等待或写入，阻塞读者
- 支持多个电梯同时读取请求池（快照）

**写者入口：w_mutex + resource**
- 写请求必须独占资源
- 阻塞后续所有读者


### 写者优先完整流程：

1. 写者进入时，若已有写者等待，读者不得进入；
2. 写者进入后锁定 `resource`；
3. 写者退出后，若无等待写者，则允许新读者进入；
4. 多读者之间不互斥，但读写互斥。

## 前端界面功能

* **每层显示电梯状态与按钮**

  * 上下按钮联动所有电梯
* **每部电梯内有独立控制面板**

  * 20 个楼层按钮 + 状态显示（门状态、方向）
* **实时状态同步**

  * 电梯移动、开关门实时刷新
* **按钮变色反馈**

  * 请求状态一目了然

---

## 功能亮点与扩展性

| 功能     | 实现情况          |
| ------ | ------------- |
| 多线程模拟  | 每部电梯一个线程    |
| 内外请求处理 | 区分请求类型并统一调度 |
| 请求去重   | 内部、外部请求防重复进入池  |
| 状态管理   | 主动向前端推送实时状态  |
| 同步与互斥  | 写者优先策略，避免冲突 |
| 界面动画   | 电梯移动、开关门可视化 |
| 按钮交互   | 联动、实时反馈  |

---